/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var b=(u,o)=>{for(var t in o)w(u,t,{get:o[t],enumerable:!0})},B=(u,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of y(o))!x.call(u,s)&&s!==t&&w(u,s,{get:()=>o[s],enumerable:!(e=N(o,s))||e.enumerable});return u};var F=u=>B(w({},"__esModule",{value:!0}),u);var M={};b(M,{default:()=>L});module.exports=F(M);var r=require("obsidian");var E={lockedNotes:new Set,lockedFolders:new Set,strictLockedNotes:new Set,mobileNotificationMaxLength:18,desktopNotificationMaxLength:22,showFileExplorerIcons:!0,showStatusBarButton:!0,showNotifications:!0,preventEditInLockedNotes:!1};var S=require("obsidian"),f=class{constructor(o){this.folderObserver=null;this.updateDebounceTimeout=null;this.plugin=o}addFileExplorerIconStyling(){let o=document.createElement("style");o.id="note-locker-styles",o.textContent=`
            .note-locker-icon {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-left: 6px;
                width: 14px;
                height: 14px;
                color: var(--text-accent);
                opacity: 0.8;
            }
            .nav-file-title, .nav-folder-title {
                display: flex;
                align-items: center;
            }
            .nav-file-title-content, .nav-folder-title-content {
                flex: 1;
                min-width: 0;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        `,document.head.appendChild(o),this.plugin.app.workspace.onLayoutReady(()=>{this.updateFileExplorerIcons(),this.setupFolderObserver()})}setupFolderObserver(){this.folderObserver&&(this.folderObserver.disconnect(),this.folderObserver=null);let o=document.querySelector(".workspace-split.mod-left-split .nav-files-container");o&&(this.folderObserver=new MutationObserver(t=>{let e=!1;for(let s of t)if(!(s.target instanceof HTMLElement&&(s.target.classList.contains("note-locker-icon")||s.target.closest(".note-locker-icon"))))if(s.type==="childList"){let i=s.target,n=i.classList.contains("nav-file-title")||i.classList.contains("nav-folder-title"),a=!1;for(let d=0;d<s.addedNodes.length;d++){let l=s.addedNodes[d];if(!(l instanceof HTMLElement&&l.classList.contains("note-locker-icon"))){a=!0;break}}if(!a)for(let d=0;d<s.removedNodes.length;d++){a=!0;break}if(a)if(n){let d=i.parentElement;d&&this.processItem(d)}else this.handleAddedNodes(s.addedNodes)}else s.type==="attributes"&&s.target instanceof HTMLElement&&(s.target.classList.contains("nav-file")||s.target.classList.contains("nav-folder"))&&this.processItem(s.target)}),this.folderObserver.observe(o,{childList:!0,attributes:!0,attributeFilter:["class","data-path","is-collapsed"],subtree:!0}))}handleAddedNodes(o){o.forEach(t=>{if(t instanceof HTMLElement){if((t.classList.contains("nav-file")||t.classList.contains("nav-folder"))&&this.processItem(t),t.classList.contains("nav-file-title")||t.classList.contains("nav-folder-title")){let i=t.parentElement;i&&this.processItem(i)}t.querySelectorAll(".nav-file, .nav-folder").forEach(i=>this.processItem(i)),t.querySelectorAll(".nav-file-title, .nav-folder-title").forEach(i=>{let n=i.parentElement;n&&this.processItem(n)})}})}processItem(o){let t=o.querySelector(".nav-file-title, .nav-folder-title");if(!t)return;let e=t.getAttribute("data-path");if(!e)return;let s=!1;o.classList.contains("nav-file")?s=this.plugin.settings.lockedNotes.has(e)||this.plugin.settings.strictLockedNotes.has(e):o.classList.contains("nav-folder")&&(s=this.plugin.settings.lockedFolders.has(e)),this.updateIconState(t,s)}updateFileExplorerIcons(){if(!this.plugin.settings.showFileExplorerIcons){this.removeFileExplorerIcons();return}document.querySelectorAll(".nav-file").forEach(e=>{let s=e.querySelector(".nav-file-title");if(!s)return;let i=s.getAttribute("data-path");if(!i)return;let n=this.plugin.settings.lockedNotes.has(i)||this.plugin.settings.strictLockedNotes.has(i);this.updateIconState(s,n)}),document.querySelectorAll(".nav-folder").forEach(e=>{let s=e.querySelector(".nav-folder-title");if(!s)return;let i=s.getAttribute("data-path");if(!i)return;let n=this.plugin.settings.lockedFolders.has(i);this.updateIconState(s,n)})}updateIconState(o,t){let e=o.querySelector(".note-locker-icon");if(t){if(!e){let s=document.createElement("div");s.addClass("note-locker-icon"),(0,S.setIcon)(s,"lock"),o.appendChild(s)}}else e&&e.remove()}removeFileExplorerIcons(){document.querySelectorAll(".note-locker-icon").forEach(o=>o.remove())}cleanup(){this.updateDebounceTimeout!==null&&(window.clearTimeout(this.updateDebounceTimeout),this.updateDebounceTimeout=null),this.folderObserver&&(this.folderObserver.disconnect(),this.folderObserver=null),this.removeFileExplorerIcons()}};var I=require("obsidian");var k=require("obsidian"),g=class extends k.Modal{constructor(t,e,s="Strictly Locked Note",i="This note is strictly locked to prevent accidental editing."){super(t);this.onUnlock=e,this.title=s,this.message=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.title}),t.createEl("p",{text:this.message}),t.createEl("p",{text:"Are you sure you want to unlock?"}),new k.Setting(t).addButton(e=>e.setButtonText("Unlock").setCta().onClick(()=>{this.onUnlock(),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}onClose(){let{contentEl:t}=this;t.empty()}};var m=class{constructor(o){this.statusBarItemEl=null;this.plugin=o}createStatusBarItem(){this.plugin.settings.showStatusBarButton&&(this.statusBarItemEl=this.plugin.addStatusBarItem(),this.statusBarItemEl&&(this.statusBarItemEl.addClass("note-locker-status"),this.statusBarItemEl.addEventListener("click",()=>{let o=this.plugin.app.workspace.getActiveFile();o&&(this.plugin.settings.strictLockedNotes.has(o.path)?new g(this.plugin.app,()=>{this.plugin.toggleStrictLock(o.path)}).open():this.plugin.toggleNoteLock(o.path))}),this.updateStatusBarButton()))}updateStatusBarButton(){if(!this.plugin.settings.showStatusBarButton||!this.statusBarItemEl)return;let o=this.isCurrentNoteActive();this.statusBarItemEl.empty();let t=document.createElement("style");if(t.textContent=`
			.note-locker-status .locker-icon {
				margin-right: 6px;
			}
		`,document.head.appendChild(t),this.plugin.app.workspace.getActiveFile()){let e=this.plugin.app.workspace.getActiveFile(),s=e?e.path:"",i=this.plugin.settings.strictLockedNotes.has(s),n=this.isCurrentNoteActive(),a=this.statusBarItemEl.createSpan({cls:"locker-icon"});i?((0,I.setIcon)(a,"lock"),a.setText("\u{1F513}"),this.statusBarItemEl.createSpan({text:" Strictly Locked"}),this.statusBarItemEl.setAttribute("aria-label","Strictly locked. Click to unlock.")):((0,I.setIcon)(a,n?"lock":"unlock"),this.statusBarItemEl.createSpan({text:n?" Locked":" Unlocked"}),this.statusBarItemEl.setAttribute("aria-label",n?"Click to unlock this note":"Click to lock this note")),this.statusBarItemEl.style.cursor="pointer"}else this.statusBarItemEl.style.cursor="default"}isCurrentNoteActive(){let o=this.plugin.app.workspace.getActiveFile();return o?this.plugin.settings.lockedNotes.has(o.path):!1}removeStatusBarItem(){this.statusBarItemEl&&(this.statusBarItemEl.detach(),this.statusBarItemEl=null)}};var p=require("obsidian"),v=class extends p.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new p.Setting(t).setName("Show locked notes in file explorer").setDesc("Display a lock icon next to locked notes in the file explorer").addToggle(l=>l.setValue(this.plugin.settings.showFileExplorerIcons).onChange(async c=>{await this.plugin.updateFileExplorerIconsVisibility(c)})),new p.Setting(t).setName("Show status bar button").setDesc("Display a lock/unlock button in the status bar for the current note").addToggle(l=>l.setValue(this.plugin.settings.showStatusBarButton).onChange(async c=>{await this.plugin.updateStatusBarVisibility(c)})),new p.Setting(t).setName("Show notifications").setDesc("Show notifications when locking or unlocking notes").addToggle(l=>l.setValue(this.plugin.settings.showNotifications).onChange(async c=>{this.plugin.settings.showNotifications=c,await this.plugin.saveSettings()})),new p.Setting(t).setName("Prevent editing in locked notes").setDesc("If enabled, normally locked notes will be read-only. If disabled, you can switch to edit mode.").addToggle(l=>l.setValue(this.plugin.settings.preventEditInLockedNotes).onChange(async c=>{this.plugin.settings.preventEditInLockedNotes=c,await this.plugin.saveSettings(),this.plugin.app.workspace.iterateAllLeaves(h=>{h.view instanceof p.MarkdownView&&h.view.file&&this.plugin.updateLeafMode(h)})}));let e=new p.Setting(t).setName("Mobile notification max length").setDesc("Maximum length of file names in notifications on mobile devices").addText(l=>l.setPlaceholder("18").setValue(String(this.plugin.settings.mobileNotificationMaxLength)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.mobileNotificationMaxLength=h,await this.plugin.saveSettings())})),s=new p.Setting(t).setName("Desktop notification max length").setDesc("Maximum length of file names in notifications on desktop").addText(l=>l.setPlaceholder("22").setValue(String(this.plugin.settings.desktopNotificationMaxLength)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.desktopNotificationMaxLength=h,await this.plugin.saveSettings())}));p.Platform.isMobile?s.settingEl.style.display="none":e.settingEl.style.display="none";let i=t.createEl("p",{text:"You can set a hotkey for locking/unlocking notes in Settings \u2192 Hotkeys \u2192 Toggle Lock for current note."});i.style.fontStyle="italic",t.createEl("h3",{text:"Locked Notes & Folders Statistics"});let n=this.plugin.settings.lockedNotes.size,a=this.plugin.settings.lockedFolders.size,d=this.plugin.settings.strictLockedNotes.size;t.createEl("p",{text:"You currently have:"}),t.createEl("ul").createEl("li",{text:`Locked notes: ${n}`}).createEl("li",{text:`Locked folders: ${a}`}).createEl("li",{text:`Strictly locked notes: ${d}`})}};var L=class extends r.Plugin{constructor(){super(...arguments);this.settings=E}async onload(){await this.loadSettings(),this.fileExplorerUI=new f(this),this.statusBarUI=new m(this),this.registerEventHandlers(),this.initializeExistingLeaves(),this.settings.showStatusBarButton&&this.statusBarUI.createStatusBarItem(),this.settings.showFileExplorerIcons&&this.fileExplorerUI.addFileExplorerIconStyling(),this.addSettingTab(new v(this.app,this)),this.addCommand({id:"toggle-note-lock",name:"Toggle Lock for current note",checkCallback:t=>{let e=this.app.workspace.getActiveFile();return e&&e.extension==="md"?(t||(this.settings.strictLockedNotes.has(e.path)?new g(this.app,()=>{this.toggleStrictLock(e.path)}).open():this.toggleNoteLock(e.path)),!0):!1}}),this.addCommand({id:"switch-to-edit-mode-intercept",name:"Switch to Edit Mode (Strict Lock Check)",hotkeys:[{modifiers:["Mod"],key:"e"}],checkCallback:t=>{let e=this.app.workspace.getActiveFile();return e&&e.extension==="md"&&this.settings.strictLockedNotes.has(e.path)?(t||new g(this.app,()=>{this.toggleStrictLock(e.path)}).open(),!0):!1}})}onunload(){let t=document.getElementById("note-locker-styles");t&&t.remove(),this.fileExplorerUI.cleanup(),this.statusBarUI.removeStatusBarItem()}registerEventHandlers(){this.registerEvent(this.app.workspace.on("file-menu",(t,e)=>this.addLockMenuItem(t,e.path))),this.registerEvent(this.app.workspace.on("files-menu",(t,e)=>this.addBulkLockMenuItem(t,e))),this.registerEvent(this.app.workspace.on("editor-menu",(t,e,s)=>s.file&&this.addLockMenuItem(t,s.file.path))),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{this.updateLeafMode(t),this.statusBarUI.updateStatusBarButton()})),this.registerEvent(this.app.vault.on("rename",async(t,e)=>{let s=!1;this.settings.lockedNotes.delete(e)&&(this.settings.lockedNotes.has(t.path)||(this.settings.lockedNotes.add(t.path),s=!0)),this.settings.lockedFolders.delete(e)&&(this.settings.lockedFolders.has(t.path)||(this.settings.lockedFolders.add(t.path),s=!0)),s&&(await this.saveSettings(),this.fileExplorerUI.updateFileExplorerIcons())})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.statusBarUI.updateStatusBarButton(),this.fileExplorerUI.updateFileExplorerIcons()})),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.fileExplorerUI.updateFileExplorerIcons(),this.app.workspace.iterateAllLeaves(t=>this.updateLeafMode(t))}))}initializeExistingLeaves(){this.app.workspace.getLeavesOfType("markdown").forEach(t=>this.updateLeafMode(t))}addBulkLockMenuItem(t,e){let s=e.filter(l=>l instanceof r.TFile&&l.extension==="md"||l instanceof r.TFolder);if(s.length<2)return;let i=!0,n=!0,a=!0;for(let l of s){let c=this.isPathLocked(l.path),h=this.settings.strictLockedNotes.has(l.path);c?n=!1:i=!1,h&&(a=!1)}i?t.addItem(l=>l.setTitle(`Unlock ${s.length} items`).setIcon("unlock").onClick(()=>{a?this.toggleBulkLock(s,!1):new g(this.app,()=>this.toggleBulkLock(s,!1),"Strictly Locked Items","At least one of the selected items is strictly locked.").open()})):n&&t.addItem(l=>l.setTitle(`Lock ${s.length} items`).setIcon("lock").onClick(()=>this.toggleBulkLock(s,!0)));let d=s.some(l=>l instanceof r.TFile);a&&d&&(n||i)&&t.addItem(l=>l.setTitle(`Strict Lock ${s.length} items`).setIcon("lock").onClick(()=>this.toggleBulkStrictLock(s,!0)))}async toggleBulkLock(t,e){for(let s of t)s instanceof r.TFile?e?this.settings.lockedNotes.add(s.path):(this.settings.lockedNotes.delete(s.path),this.settings.strictLockedNotes.delete(s.path)):s instanceof r.TFolder&&(e?this.settings.lockedFolders.add(s.path):this.settings.lockedFolders.delete(s.path));await this.saveSettings(),this.fileExplorerUI.updateFileExplorerIcons(),this.app.workspace.iterateAllLeaves(s=>{if(s.view instanceof r.MarkdownView&&s.view.file){let i=s.view.file.path;t.some(n=>n.path===i||n instanceof r.TFolder&&i.startsWith(n.path+"/"))&&this.updateLeafMode(s)}})}async toggleBulkStrictLock(t,e){for(let s of t)s instanceof r.TFile&&(e?this.settings.strictLockedNotes.add(s.path):this.settings.strictLockedNotes.delete(s.path));await this.saveSettings(),this.fileExplorerUI.updateFileExplorerIcons(),this.app.workspace.iterateAllLeaves(s=>{if(s.view instanceof r.MarkdownView&&s.view.file){let i=s.view.file.path;t.some(n=>n.path===i)&&this.updateLeafMode(s)}})}addLockMenuItem(t,e){if(this.isParentFolderLocked(e))return;let s=this.app.vault.getAbstractFileByPath(e);if(s instanceof r.TFile&&s.extension==="md"){let i=this.settings.lockedNotes.has(e),n=this.settings.strictLockedNotes.has(e);n||t.addItem(a=>a.setTitle(i?"Unlock":"Lock").setIcon(i?"unlock":"lock").onClick(()=>this.toggleNoteLock(e))),i||(n?t.addItem(a=>a.setTitle("Strict Unlock").setIcon("unlock").onClick(()=>{new g(this.app,()=>{this.toggleStrictLock(e)}).open()})):t.addItem(a=>a.setTitle("Strict Lock").setIcon("lock").onClick(()=>this.toggleStrictLock(e))))}else if(s&&!(s instanceof r.TFile)){let i=this.settings.lockedFolders.has(e);t.addItem(n=>n.setTitle(i?"Unlock all notes in folder":"Lock all notes in folder").setIcon(i?"unlock":"lock").onClick(()=>this.toggleFolderLock(e)))}}isParentFolderLocked(t){let e=t;for(;e.includes("/");)if(e=e.substring(0,e.lastIndexOf("/")),this.settings.lockedFolders.has(e))return!0;return!1}async toggleFolderLock(t){let e=this.settings.lockedFolders.has(t);e?this.settings.lockedFolders.delete(t):this.settings.lockedFolders.add(t),await this.saveSettings(),new r.Notice(`${e?"\u{1F513} Unlocked":"\u{1F512} Locked"} folder: ${t}`),this.updateAllNotesInFolder(t),this.statusBarUI.updateStatusBarButton(),this.fileExplorerUI.updateFileExplorerIcons()}updateAllNotesInFolder(t){this.app.workspace.getLeavesOfType("markdown").forEach(e=>{e.view instanceof r.MarkdownView&&e.view.file&&e.view.file.path.startsWith(t+"/")&&this.updateLeafMode(e)})}async toggleNoteLock(t){var i;let e=this.settings.lockedNotes.has(t);e?this.settings.lockedNotes.delete(t):this.settings.lockedNotes.add(t),await this.saveSettings();let s=this.app.vault.getAbstractFileByPath(t);if(!s){new r.Notice("Error: Note not found");return}if(this.settings.showNotifications){let n=s instanceof r.TFile?s.basename:((i=t.split("/").pop())==null?void 0:i.replace(/\..+$/,""))||t,a=this.truncateFileName(n);new r.Notice(`${e?"\u{1F513} Unlocked":"\u{1F512} Locked"}: ${a}`)}this.updateAllNoteInstances(t),this.statusBarUI.updateStatusBarButton(),this.fileExplorerUI.updateFileExplorerIcons()}async toggleStrictLock(t){let e=this.settings.strictLockedNotes.has(t);e?this.settings.strictLockedNotes.delete(t):this.settings.strictLockedNotes.add(t),await this.saveSettings(),new r.Notice(`${e?"\u{1F513} Strictly Unlocked":"\u{1F512} Strictly Locked"}: ${t}`),this.updateAllNoteInstances(t),this.statusBarUI.updateStatusBarButton(),this.fileExplorerUI.updateFileExplorerIcons()}truncateFileName(t){let e=r.Platform.isMobile?this.settings.mobileNotificationMaxLength:this.settings.desktopNotificationMaxLength;return t.length>e?`${t.slice(0,e)}\u2026`:t}updateAllNoteInstances(t){this.app.workspace.getLeavesOfType("markdown").filter(e=>this.isSameNote(e,t)).forEach(e=>this.updateLeafMode(e))}isSameNote(t,e){var i;let s=t.view;return s instanceof r.MarkdownView&&((i=s.file)==null?void 0:i.path)===e}isPathLocked(t){if(this.settings.strictLockedNotes.has(t)||this.settings.lockedNotes.has(t))return!0;let e=t;for(;e.includes("/");)if(e=e.substring(0,e.lastIndexOf("/")),this.settings.lockedFolders.has(e))return!0;return!1}updateLeafMode(t){var a,d,l;if(!t||!(t.view instanceof r.MarkdownView))return;let{view:e}=t,s=(a=e.file)==null?void 0:a.path;if(!s)return;let i=this.settings.strictLockedNotes.has(s),n=this.isPathLocked(s);if(i){let c=t.getViewState();if(((d=c.state)==null?void 0:d.mode)==="source"){t.setViewState({...c,state:{...c.state,mode:"preview"}}),this.app.workspace.activeLeaf===t&&new g(this.app,()=>{this.toggleStrictLock(s)}).open();return}}else if(n){let c=t.getViewState();this.settings.preventEditInLockedNotes&&((l=c.state)==null?void 0:l.mode)==="source"&&t.setViewState({...c,state:{...c.state,mode:"preview"}})}i?(this.hideEditButtons(e),this.addStrictLockButton(e,s)):n&&this.settings.preventEditInLockedNotes?(this.hideEditButtons(e),this.removeStrictLockButton(e)):(this.showEditButtons(e),this.removeStrictLockButton(e))}hideEditButtons(t){t.containerEl.querySelectorAll(".view-action").forEach(i=>{if(i instanceof HTMLElement){let n=i.getAttribute("aria-label")||"";(!!i.querySelector(".lucide-pencil")||n.includes("Edit")||n.includes("edit")||n.includes("Switch to editing"))&&(i.style.display="none")}})}showEditButtons(t){t.containerEl.querySelectorAll(".view-action").forEach(i=>{var n,a;i instanceof HTMLElement&&((n=i.getAttribute("aria-label"))!=null&&n.includes("Edit")||(a=i.getAttribute("aria-label"))!=null&&a.includes("edit")||i.querySelector(".lucide-pencil"))&&(i.style.display="")})}addStrictLockButton(t,e){let s=t.containerEl,i=s.querySelector(".note-locker-strict-btn");if(!i){i=document.createElement("div"),i.addClass("view-action","clickable-icon","note-locker-strict-btn"),i.setAttribute("aria-label","Strictly Locked"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>',i.addEventListener("click",()=>{new g(this.app,()=>{this.toggleStrictLock(e)}).open()});let n=s.querySelector(".view-actions");n&&n.prepend(i)}}removeStrictLockButton(t){let s=t.containerEl.querySelector(".note-locker-strict-btn");s&&s.remove()}async loadSettings(){let t=await this.loadData();t&&(this.settings={...E,...t,lockedNotes:new Set(t.lockedNotes||[]),lockedFolders:new Set(t.lockedFolders||[]),strictLockedNotes:new Set(t.strictLockedNotes||[])})}async saveSettings(){await this.saveData({...this.settings,lockedNotes:Array.from(this.settings.lockedNotes),lockedFolders:Array.from(this.settings.lockedFolders),strictLockedNotes:Array.from(this.settings.strictLockedNotes)})}async updateFileExplorerIconsVisibility(t){this.settings.showFileExplorerIcons=t,t?this.fileExplorerUI.addFileExplorerIconStyling():this.fileExplorerUI.removeFileExplorerIcons(),await this.saveSettings()}async updateStatusBarVisibility(t){this.settings.showStatusBarButton=t,t?this.statusBarUI.statusBarItemEl||this.statusBarUI.createStatusBarItem():this.statusBarUI.removeStatusBarItem(),await this.saveSettings()}};

/* nosourcemap */